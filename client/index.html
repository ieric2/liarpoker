<html>

<head>
  <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>

  <script>
  </script>
</head>


<body>
  <div id="joinScreen"> 
    WELCOME TO LIARS POKER
  <input type="button" name="joinGameButton" value="Join Game" onclick="joinGame()"/>
  </div>

  <div id="waitingScreen" style="display: none;">
    <text>
      Waiting to start game... 
    </text>
    <br><br>
    <form>
      <input type="text" id="setNameField"/>
      <button type="button" onclick="setName()">Set Name</button>
    </form>
    <br><br>
    <input type="button" name="startGameButton" value= "Start Game" onclick="startGame()"/>
  </div>

  <div id="gameScreen" style="display: none;">
    <!-- Add a player turn display -->
    <!-- Add a turn history tracker -->
    <div class="container" style="display: flex;">
      <canvas id="ctx"  style="width:50%;height:500px; border:2px solid #000000;"></canvas>   
      <div id="chat" style="width:50%;height:500px; overflow-y:scroll; padding-left: 10px;">
      </div>
    </div>
    <br>
    <form action="result.php" method="post" id="handSelection" style="vertical-align: top;">
      <select name="category" id="handTypeSelector" style="vertical-align: top;">
        <option value="highCard">High Card</option>
        <option value="pair">Pair</option>
        <option value="twoPair">Two Pair</option> 
        <option value="triple">Three of a Kind</option> 
        <option value="straight">Straight</option> 
        <option value="flush">Flush</option>
        <option value="fullHouse">Full House</option> 
        <option value="quad">Four of a Kind</option>
        <option value="straightFlush">Straight Flush</option> 
        <option value="royalFlush">Royal Flush</option>
      </select>
      <select name="choices[]" id="handSubtypeSelector" size="4" style="min-width: 100px;">
          <!-- js populates -->
      </select>
      <select name="choices2[]" id="handSubtype2Selector" size="4" style="min-width: 100px;">
        <!-- js populates -->
      </select>
      <p></p>
      <button type="button" onclick="playTurn()">Submit Hand</button>
      <button type="button" onclick="castDoubt()">Cast Doubt</button>
    </form>
  </div>


  <script>

    var socket = io()

    var cards = {}

    var id = socket.id;

    var chat = document.getElementById("chat");


    function joinGame(){
      document.getElementById("joinScreen").style.display = "none";
      document.getElementById("waitingScreen").style.display = "block";
      socket.emit("joinGame");
    }

    function setName(){
      // console.log(document.getElementById("setNameField"));
      socket.emit('setName', document.getElementById("setNameField").value);
    }

    function startGame(){
      socket.emit('startGame');
    }

    socket.on('gameStarting', function(data){
        const ctx = document.getElementById("ctx").getContext("2d");
        ctx.font = '24px Arial';

        cards = data.cards;
        for (var i = 0; i < cards.length; i++){
          console.log(cards[i]);
        }
        
        document.getElementById("joinScreen").style.display = "none";
        document.getElementById("waitingScreen").style.display = "none";
        document.getElementById("gameScreen").style.display = "block";
    });


    function playTurn(){
      var handType = document.getElementById("handTypeSelector").value;
      var handVariant = document.getElementById("handSubtypeSelector").value;
      var handVariant2 = document.getElementById("handSubtype2Selector").value;
      socket.emit("playTurn", {0: handType, 1: handVariant, 2: handVariant2});
    }

    function castDoubt(){
      socket.emit("checkHand");
    }

    socket.on("resolveDoubt", function(data){
      if(data){
        chat.innerHTML += '<div>' + data.doubter + ' incorrectly doubted ' + data.doubtee + '</div>';
      }
    })

    socket.on("addToChat", function(data){
      chat.innerHTML += '<div>' + data + '</div>';
    });

  </script>


  <script>
    function removeAllOptions(sel, removeGrp) {
      var len, groups, par;
      if (removeGrp) {
        groups = sel.getElementsByTagName('optgroup');
        len = groups.length;
        for (var i=len; i; i--) {
          sel.removeChild( groups[i-1] );
        }
      }
      len = sel.options.length;
      for (var i=len; i; i--) {
        par = sel.options[i-1].parentNode;
        par.removeChild( sel.options[i-1] );
      }
    }

    function appendDataToSelect(sel, obj) {
      var f = document.createDocumentFragment();
      var labels = [], group, opts;

      function addOptions(obj) {
        var f = document.createDocumentFragment();
        var o;
        for (var i=0, len=obj.text.length; i<len; i++) {
          o = document.createElement('option');
          o.appendChild( document.createTextNode( obj.text[i] ) );
          if ( obj.value ) {
            o.value = obj.value[i];
          }
          f.appendChild(o);
        }
        return f;
      }
      
      if ( obj.text ) {
        opts = addOptions(obj);
        f.appendChild(opts);
      } else {
        for ( var prop in obj ) {
          if ( obj.hasOwnProperty(prop) ) {
            labels.push(prop);
          }
        }
        for (var i=0, len=labels.length; i<len; i++) {
          group = document.createElement('optgroup');
          group.label = labels[i];
          f.appendChild(group);
          opts = addOptions(obj[ labels[i] ] );
          group.appendChild(opts);
        }
      }
      sel.appendChild(f);
    }

    // anonymous function assigned to onchange event of controlling select list
    document.forms['handSelection'].elements['category'].onchange = function(e) {
      var relName = 'choices[]';
      var relList = this.form.elements[relName];
      var obj = Select_List_Data[ relName ][ this.value ];

      removeAllOptions(relList, true);
      appendDataToSelect(relList, obj);

      var relName2 = 'choices2[]';
      var relList2 = this.form.elements[relName2];
      var obj2 = Select_List_Data[ relName2 ][ this.value ];

      removeAllOptions(relList2, true);
      appendDataToSelect(relList2, obj2);
    };

    var Select_List_Data = {
      'choices[]': {
        royalFlush: {
          text: []
        },
        straightFlush: {
          text: ["Heart", "Spade", "Diamond", "Club"]
        },
        quad:{
          text: ["2", "3", "4", "5", "6", "7", "8", "9", "J", "Q", "K", "A"]
        },
        fullHouse:{
          text: ["2", "3", "4", "5", "6", "7", "8", "9", "J", "Q", "K", "A"]
        },
        flush: {
          text: ["Heart", "Spade", "Diamond", "Club"]
        },
        straight: {
          text: ["A - 5", "2 - 6", "3 - 7", "4 - 8", "5 - 9", "6 - 10", "7 - J", "8 - Q", "9 - K", "10 - A"]
        },
        triple:{
          text: ["2", "3", "4", "5", "6", "7", "8", "9", "J", "Q", "K", "A"]
        },
        twoPair:{
          text: ["2", "3", "4", "5", "6", "7", "8", "9", "J", "Q", "K", "A"]
        },
        pair:{
          text: ["2", "3", "4", "5", "6", "7", "8", "9", "J", "Q", "K", "A"]
        },
        highCard:{
          text: ["2", "3", "4", "5", "6", "7", "8", "9", "J", "Q", "K", "A"]
        }
      },
      'choices2[]': {
        royalFlush: {
          text: []
        },
        straightFlush: {
          text: ["A-5", "2-6", "3-7", "4-8", "5-9", "6-10", "7-J", "8-Q", "9-K", "10-A"]
        },
        quad:{
          text: []
        },
        fullHouse:{
          text: ["2", "3", "4", "5", "6", "7", "8", "9", "J", "Q", "K", "A"]
        },
        flush: {
          text: []
        },
        straight: {
          text: []
        },
        triple:{
          text: []
        },
        twoPair:{
          text: ["2", "3", "4", "5", "6", "7", "8", "9", "J", "Q", "K", "A"]
        },
        pair:{
          text: []
        },
        highCard:{
          text: []
        }
      }
        
    };

    // populate associated select list when page loads
    window.onload = function() {
      var form = document.forms['handSelection'];
      
      // reference to controlling select list
      var sel = form.elements['category'];
      sel.selectedIndex = 0;

      var sel2 = form.elements['category'];
      sel2.selectedIndex = 0;
      
      var relName = 'choices[]';
      var rel = form.elements[ relName ];
      var data = Select_List_Data[ relName ][ sel.value ];

      var relName2 = 'choices2[]';
      var rel2 = form.elements[ relName2 ];
      var data2= Select_List_Data[ relName2 ][ sel.value ];
      
      // add options to associated select list
      appendDataToSelect(rel, data);
      appendDataToSelect(rel2, data2);

    };
  </script>
  
</body>



</html>
